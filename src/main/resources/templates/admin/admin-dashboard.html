<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Zenex</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family:Poppins, sans-serif;
    background:#0b1220;
    color:white;
}

/* SIDEBAR */
.sidebar{
    position:fixed;top:0;left:0;
    width:240px;height:100vh;
    background:#060c18;padding:20px;
}
.sidebar h2{color:#00eaff;text-align:center;margin-bottom:30px}
.sidebar a{
    display:block;padding:12px;margin:8px 0;
    color:#cfd8ff;text-decoration:none;border-radius:8px;
}
.sidebar a:hover,.sidebar a.active{
    background:#00eaff;color:#001423;font-weight:600;
}

/* MAIN */
.main{margin-left:260px;padding:30px}

/* CHAT */
#adminChat{
    position:fixed;right:20px;bottom:20px;
    width:320px;background:#121a2f;
    border-radius:14px;overflow:hidden;
}
#chatArea{
    height:220px;overflow-y:auto;
    padding:8px;font-size:13px;
}
.msg-admin{color:#00eaff}
.msg-user{color:#ffea76}
</style>
</head>

<body>

<div class="sidebar">
    <h2>âš™ Zenex Admin</h2>
    <a href="/admin/dashboard" class="active">ðŸ“Š Dashboard</a>
    <a href="/admin/tickets">ðŸŽ« Tickets</a>
    <a href="/admin/reports">ðŸ“‘ Reports</a>
    <a href="/admin/analytics">ðŸ“ˆ Analytics</a>
    <a href="/admin/chat-reports">ðŸ’¬ Chat Reports</a>
    <a href="/logout">ðŸšª Logout</a>
</div>

<div class="main">
    <h1 style="color:#00eaff">Dashboard</h1>

    <!-- CHAT BOX -->
    <div id="adminChat">
        <div style="background:#00eaff;color:#001423;padding:10px;font-weight:700">
            ðŸ’¬ Live User Chat
        </div>

        <div style="padding:8px">
            <input id="empId" placeholder="Employee ID"
            style="width:100%;padding:6px;border-radius:6px;border:none">
        </div>

        <div id="chatArea"></div>

        <div style="display:flex;padding:8px;gap:6px">
            <input id="adminMsg" placeholder="Reply..."
            style="flex:1;padding:6px;border-radius:6px;border:none">
            <button onclick="sendAdmin()" style="
            background:#00eaff;border:none;padding:6px 10px;
            border-radius:6px;font-weight:600">Send</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
let stomp=null;
let currentEmp=null;

function connect(){
    if(stomp) return;
    let socket=new SockJS("/chat-support");
    stomp=Stomp.over(socket);
    stomp.connect({},()=>{});
}

document.getElementById("empId").addEventListener("change",()=>{
    connect();
    currentEmp=empId.value;

    stomp.subscribe("/topic/chat/"+currentEmp,(m)=>{
        let d=JSON.parse(m.body);
        chatArea.innerHTML+=
        `<div class="${d.sender==='ADMIN'?'msg-admin':'msg-user'}">
         <b>${d.sender}:</b> ${d.message}</div>`;
        chatArea.scrollTop=chatArea.scrollHeight;
    });
});

function sendAdmin(){
    if(!currentEmp||!adminMsg.value) return;
    connect();

    stomp.send("/app/chat.send",{},JSON.stringify({
        employeeId:currentEmp,
        sender:"ADMIN",
        message:adminMsg.value
    }));
    adminMsg.value="";
}
</script>

</body>
</html>

