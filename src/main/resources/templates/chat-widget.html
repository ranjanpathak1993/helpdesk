<div id="chatIcon">ðŸ’¬</div>

<div id="chatBox" style="display:none;">
  <h4>Welcome to Chat Support</h4>
  <input id="empId" placeholder="Employee ID / Name" />
  <div id="messages"></div>
  <input id="msg" placeholder="Type message..." />
  <button onclick="send()">Send</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>

<script>
let stomp;
let empId;

document.getElementById("chatIcon").onclick = () => {
  document.getElementById("chatBox").style.display="block";
};

function connect() {
  empId = document.getElementById("empId").value;
  let socket = new SockJS('/chat-support');
  stomp = Stomp.over(socket);

  stomp.connect({}, () => {
    stomp.subscribe('/topic/chat/' + empId, (msg) => {
      let m = JSON.parse(msg.body);
      document.getElementById("messages").innerHTML +=
        `<div>${m.sender}: ${m.message}</div>`;
    });
  });
}

function send() {
  if(!stomp) connect();
  stomp.send("/app/chat.send", {}, JSON.stringify({
    employeeId: empId,
    sender: "USER",
    message: document.getElementById("msg").value
  }));
}
</script>
