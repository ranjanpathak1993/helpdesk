<!DOCTYPE html>
<html>
<head>
<title>Admin Chat Panel</title>

<style>
#adminBox {
  width: 600px;
  margin: auto;
  margin-top: 40px;
  padding: 20px;
  background: #ffffff;
  border-radius: 10px;
}

.msg-user {
  background: #d1e7ff;
  padding: 8px;
  border-radius: 8px;
  margin: 5px 0;
  width: fit-content;
  max-width: 85%;
}

.msg-admin {
  background: #ffe4d1;
  padding: 8px;
  border-radius: 8px;
  margin: 5px 0;
  width: fit-content;
  max-width: 85%;
  margin-left: auto;
}
</style>

</head>
<body>

<div id="adminBox">
  <h2>Admin Live Chat</h2>

  <input id="empId" placeholder="Enter Employee ID" style="width:100%">

  <div id="messages" style="height:300px;overflow-y:auto;background:#f5f5f5;margin-top:10px;padding:10px;"></div>

  <input id="msg" placeholder="Type reply..." style="width:70%">
  <button onclick="sendAdmin()">Send</button>
</div>

<script>

function sendAdmin(){
    const emp = document.getElementById("empId").value;
    const msg = document.getElementById("msg").value;

    if(!emp || !msg) return;

    fetch("/chat/send", {
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:`employeeId=${emp}&message=${encodeURIComponent(msg)}&sender=ADMIN`
    }).then(()=>{
        document.getElementById("msg").value = "";
        loadChat(emp);
    });
}

function loadChat(emp){
    fetch("/chat/history/" + emp)
    .then(r => r.json())
    .then(data => {
        let html = "";
        data.forEach(m => {
            if(m.sender === "ADMIN"){
                html += `<div class="msg-admin">${m.message}</div>`;
            } else {
                html += `<div class="msg-user">${m.message}</div>`;
            }
        });

        document.getElementById("messages").innerHTML = html;
        const box = document.getElementById("messages");
        box.scrollTop = box.scrollHeight;
    });
}

// Auto-refresh
setInterval(()=>{
    const emp = document.getElementById("empId").value;
    if(emp) loadChat(emp);
}, 2000);

</script>

</body>
</html>
